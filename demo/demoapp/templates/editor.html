{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="{% static 'vendors/font-awesome/font-awesome.min.css' %}" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma-accordion@2.0.1/dist/css/bulma-accordion.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css">

    <title>Document</title>
</head>

<style>
    .ui-sortable-handle {
        z-index: 1;
        margin: 0;
        padding: 0;
    }

    body {
        background-color: rgb(58, 58, 226);
    }

    .cols {
        padding: 10px;
        margin-top: 5px;
    }

    .cols .column {
        padding: 10px;
    }

    .parag {
        padding: 10px;
    }

    .drag {
        overflow-y: auto;
    }
</style>

<body>
    <nav class="navbar" role="navigation" aria-label="main navigation">
        <div class="navbar-brand">
            <a class="navbar-item" href="https://bulma.io">
                <img src="https://bulma.io/images/bulma-logo.png" width="112" height="28">
            </a>

            <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false"
                data-target="navbarBasicExample">
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
            </a>
        </div>

        <div class="navbar-end">
            <div class="navbar-item">
                <div class="buttons">
                    <a id="files" class="button is-primary is-hidden">
                        <strong>Download</strong>
                    </a>
                </div>
            </div>
        </div>
        </div>
    </nav>
    <div class="columns pt-5 pl-3 pr-3">
        <div class='column is-3'>
            <div class="card">
                <div class="card-content">
                    <div class="card-title">
                        <h2 class="pb-2"> Blocks </h2>
                    </div>
                    <section class="accordions">
                        <article class="accordion is-active">
                            <div class="accordion-header">
                                <p>Headers</p>
                                <button class="toggle" aria-label="toggle"></button>

                            </div>
                            <div class="accordion-body">
                                <div class="accordion-content">
                                    <div class=" columns is-align-items-center">
                                        <div class="column is-one-third">
                                            <span id="nav-1" class="bb button is-small">Drag</span>
                                        </div>
                                        <div class="column">
                                            <p class="has-text-right">Navbar</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </article>
                        <article class="accordion">
                            <div class="accordion-header">
                                <p>Columns</p>
                                <button class="toggle" aria-label="toggle"></button>
                            </div>
                            <div class="accordion-body">
                                <div class="accordion-content">
                                    <div class="columns is-align-items-center">
                                        <div class="column is-one-third">
                                            <span id="col-8-4" class="bb button is-small">Drag</span>
                                        </div>
                                        <div class="column">
                                            <p class="has-text-right">Col 8-4</p>
                                        </div>
                                    </div>
                                    <div class=" columns is-align-items-center">
                                        <div class="column is-one-third">
                                            <span id="col-6-6" class="bb button is-small">Drag</span>
                                        </div>
                                        <div class="column">
                                            <p class="has-text-right">Col 6-6</p>
                                        </div>
                                    </div>
                                    <div class=" columns is-align-items-center">
                                        <div class="column is-one-third">
                                            <span id="col-4-4-4" class="bb button is-small">Drag</span>
                                        </div>
                                        <div class="column">
                                            <p class="has-text-right">Col 4-4-4</p>
                                        </div>
                                    </div>
                                </div>
                        </article>
                        <article class="accordion">
                            <div class="accordion-header">
                                <p>Text</p>
                                <button class="toggle" aria-label="toggle"></button>
                            </div>
                            <div class="accordion-body">
                                <div class="accordion-content">
                                    <div class=" columns is-align-items-center">
                                        <div class="column is-one-third">
                                            <span id="text" class="bb button is-small">Drag</span>
                                        </div>
                                        <div class="column">
                                            <p class="has-text-right">Paragraph</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </article>
                    </section>
                </div>
            </div>
        </div>
        <div class='column is-9 has-background-blue'>
            <div class="drag has-background-primary" style="height: 500px;">
            </div>
        </div>
    </div>

    <script src="{% static 'vendors/jquery/jquery.min.js' %}"></script>

    <script src="https://cdn.jsdelivr.net/npm/bulma-accordion@2.0.1/dist/js/bulma-accordion.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"
        integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU=" crossorigin="anonymous"></script>
    <script src="https://kit.fontawesome.com/2c36e9b7b1.js" crossorigin="anonymous"></script>
    <script>
        $(document).ready(function () {
            var accordions = bulmaAccordion.attach();


            $(".bb").draggable({
                helper: "clone",
                cursor: "pointer",
                zIndex: 101,

            });



            $(".drag").droppable({
                accept: ".bb",
                drop: function (event, ui) {
                    $(this).append(components(ui.draggable[0].id));
                    viewDownload();
                }
            }).sortable({
                cursor: "move",
                helper: function (evt, ui) {
                    return $(ui).clone().appendTo($(this)).show();

                }
            });
            $("#files").click(function () {
                var pages = new Blob([exportpdf()], { type: "text/plain;charset=utf-8" });
                downloadpages(pages, "example.html");
            });

            function  downloadpages(content, filename) {
                var reader = new FileReader();
                reader.onload = function (event) {
                    var save = document.createElement('a');
                    save.href = event.target.result;
                    save.target = '_blank';
                    save.download = filename;
                    var clicEvent = new MouseEvent('click', {
                        'view': window,
                        'bubbles': true,
                        'cancelable': true
                    });
                    save.dispatchEvent(clicEvent);
                    (window.URL || window.webkitURL).revokeObjectURL(save.href);
                };
                reader.readAsDataURL(content);
            };

        });


        function components(options) {
            let result = "";
            switch (options) {
                case 'nav-1':
                    result = navbar()
                    break;
                case 'col-8-4':
                    result = grid([8, 4]);
                    break;
                case 'col-6-6':
                    result = grid([6, 6]);
                    break;
                case 'col-4-4-4':
                    result = grid([4, 4, 4]);
                    break;
                case 'text':
                    result = paragraph();
                    break;
                default:
                    break;
            }
            return result;
        }
        function navbar() {
            return `<nav class="navbar is-primary" role="navigation" aria-label="main navigation"><div class="navbar-brand">
    <a class="navbar-item" href="https://bulma.io"><img src="https://bulma.io/images/bulma-logo.png" width="112" height="28">
    </a><a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="navbarBasicExample">
      <span aria-hidden="true"></span><span aria-hidden="true"></span><span aria-hidden="true"></span></a>
  </div><div id="navbarBasicExample" class="navbar-menu"><div class="navbar-start">
      <a class="navbar-item">Home</a><a class="navbar-item">Documentation</a>
      <div class="navbar-item has-dropdown is-hoverable"><a class="navbar-link">More</a><div></nav>`;
        }
        function grid(sizes) {
            a = `<div class="container"> <div class="columns ui-sortable-handle is-centered is-vcentered cols has-background-white">`;
            for (let i = 0; i < sizes.length; i++) {
                a += `<div class="column is-${sizes[i]}  ui-droppable ui-sortable  p-3">
                    <p contenteditable="true" onclick='$(this).focus();'>   Lorem ipsum dolor sit amet consectetur adipisicing elit. Voluptatum, non dolorum eveniet cupiditate quia voluptatem sunt a repellat fugit? Quaerat quae facilis dignissimos aliquam necessitatibus deserunt, explicabo soluta suscipit? Mollitia?</p></div> `
            }
            a += `</div> </div>`;
            return a;
        }

        function paragraph() {
            return `<div class="container p-3 has-background-white"><p contenteditable="true"onclick='$(this).focus();'>Lorem ipsum dolor sit amet consectetur adipisicing elit. Maxime tempora vitae itaque quod iure, nobis culpa totam, voluptatem voluptates necessitatibus molestiae. Nostrum sit vel magni omnis nisi dicta incidunt ipsam?</p></div>`;
        }

        function viewDownload() {
            $("#files").removeClass("is-hidden");
        }

        function exportpdf() {
            data = ` <!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="{% static 'vendors/font-awesome/font-awesome.min.css' %}" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma-accordion@2.0.1/dist/css/bulma-accordion.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css">

    <title>Document</title>
</head>
<style>
    .cols{
        padding: 10px;
        margin-top: 5px;
    }
    .parag{
        padding: 10px;
    }
    </style>
<body>`+ $('.drag').html();
            data += `</body>

</html>`;
            return data;
        }
    </script>
</body>

</html>